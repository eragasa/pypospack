

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pypospack.io.vasp &#8212; Materials Ex Machina 2017.7.22 documentation</title>
    <link rel="stylesheet" href="../../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/bizstyle.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Materials Ex Machina 2017.7.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pypospack.io.vasp</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;Input and output functions and classes for VASP &quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Eugene J. Ragasa&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2016,2017&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Simplified BSD License&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="c1">#import pyflamestk.base as base</span>
<span class="kn">import</span> <span class="nn">pypospack.crystal</span> <span class="k">as</span> <span class="nn">crystal</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># *****************************************************************************</span>
<span class="c1"># ****    ERROR EXCEPTION HANDLING CLASSES                                 ****</span>
<span class="c1"># *****************************************************************************</span>

<div class="viewcode-block" id="VaspIncarError"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspIncarError">[docs]</a><span class="k">class</span> <span class="nc">VaspIncarError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Error class for reading/writing VASP INCAR IO issues &quot;&quot;&quot;</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspPoscarError"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspPoscarError">[docs]</a><span class="k">class</span> <span class="nc">VaspPoscarError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Error class for reading/writing VASP POSCAR IO issues &quot;&quot;&quot;</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspPotcarError"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspPotcarError">[docs]</a><span class="k">class</span> <span class="nc">VaspPotcarError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Error class for reading/writing VASP POTCAR IO issues &quot;&quot;&quot;</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="c1"># *****************************************************************************</span>
<span class="c1"># ****    SOME CONVENIENCE FUNCTIONS                                       ****</span>
<span class="c1"># *****************************************************************************</span>

<div class="viewcode-block" id="read_poscar_file"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.read_poscar_file">[docs]</a><span class="k">def</span> <span class="nf">read_poscar_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">poscar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">()</span>
    <span class="n">poscar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">poscar</span></div>

<div class="viewcode-block" id="write_poscar_file"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.write_poscar_file">[docs]</a><span class="k">def</span> <span class="nf">write_poscar_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj_poscar</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">):</span>
    <span class="n">obj_poscar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="read_incar_file"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.read_incar_file">[docs]</a><span class="k">def</span> <span class="nf">read_incar_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">()</span>
    <span class="n">incar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">incar</span></div>

<div class="viewcode-block" id="make_super_cell"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.make_super_cell">[docs]</a><span class="k">def</span> <span class="nf">make_super_cell</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scp</span><span class="p">):</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">make_super_cell</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">scp</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">Poscar</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span></div>

<span class="c1"># *****************************************************************************</span>
<span class="c1"># ****     CORE CLASSES                                                    ****</span>
<span class="c1"># *****************************************************************************</span>

<div class="viewcode-block" id="VaspSimulation"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation">[docs]</a><span class="k">class</span> <span class="nc">VaspSimulation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; class for managing vasp simulations</span>
<span class="sd">   </span>
<span class="sd">    This class encapsulates are variety of object for a vasp simulation</span>

<span class="sd">    Args:</span>
<span class="sd">        sim_dir(str): the path of this simulation</span>
<span class="sd">        xc(str): the exchange correlation functional</span>

<span class="sd">    Attribute:</span>
<span class="sd">        poscar (pypospack.io.poscar): class for mananging IO of structures for vasp.</span>
<span class="sd">        incar (pypospack.io.incar): class for managing IO of DFT configuration for vasp</span>
<span class="sd">        kpoints (pypospack.io.kpoints): defines the the grid for BZ zone integration.</span>
<span class="sd">        potcar (pypospack.io.potcar): defines potential file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sim_dir</span><span class="p">,</span><span class="n">xc</span><span class="o">=</span><span class="s1">&#39;GGA&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_req_met</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_job_pending</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_job_initalized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_job_submitted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_job_complete</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_job_finished</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># vasp input/output filehandlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span> <span class="o">=</span> <span class="n">Potcar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># set simulation directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_restart_info</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_simulation_directory</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_restart_info</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_dir</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__set_simulation_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sim_dir</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="VaspSimulation.read_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation.read_incar">[docs]</a>    <span class="k">def</span> <span class="nf">read_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;INCAR&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation.write_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation.write_incar">[docs]</a>    <span class="k">def</span> <span class="nf">write_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;INCAR&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation.read_poscar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation.read_poscar">[docs]</a>    <span class="k">def</span> <span class="nf">read_poscar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation.write_poscar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation.write_poscar">[docs]</a>    <span class="k">def</span> <span class="nf">write_poscar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation.write_kpoints"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation.write_kpoints">[docs]</a>    <span class="k">def</span> <span class="nf">write_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;KPOINTS&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation.write_potcar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation.write_potcar">[docs]</a>    <span class="k">def</span> <span class="nf">write_potcar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation.read_simulation_cell"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspSimulation.read_simulation_cell">[docs]</a>    <span class="k">def</span> <span class="nf">read_simulation_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_poscar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__get_symbols_poscar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspMinimizeStructure"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.VaspMinimizeStructure">[docs]</a><span class="k">class</span> <span class="nc">VaspMinimizeStructure</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; class for managing vasp structural minimizations &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sim_dir</span><span class="p">,</span><span class="n">structure</span><span class="p">,</span> <span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;GGA&#39;</span><span class="p">):</span>
        <span class="n">VaspSimulation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">instance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__process_poscar_file</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__process_poscar_file</span><span class="p">():</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Incar">[docs]</a><span class="k">class</span> <span class="nc">Incar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; object for dealing with input and output to VASP via INCAR file </span>

<span class="sd">        Args:</span>
<span class="sd">        filename (str): the filename of the INCAR file, default:&#39;INCAR&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span> <span class="o">=</span> <span class="s1">&#39;# </span><span class="si">{:*^78}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;30}</span><span class="s1">! </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span> <span class="o">=</span> <span class="n">initialize_incar_comments</span><span class="p">()</span>
        
        <span class="c1"># default initialization of INCAR file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;automatically generated by pyflamestk&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_start_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_density_of_states</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_symmetry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_scf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_spin</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_ionic_relaxation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_output</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init_start_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">istart</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icharg</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init_density_of_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ismear</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span>

    <span class="k">def</span> <span class="nf">__init_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isym</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symprec</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="k">def</span> <span class="nf">__init_scf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ediff</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># convergece criteria in eV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nelm</span> <span class="o">=</span> <span class="mi">40</span> <span class="c1"># maximum number of SCF steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># energy cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="s1">&#39;High&#39;</span>  <span class="c1"># set avoid anti-aliasing errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">=</span> <span class="s1">&#39;False&#39;</span> <span class="c1"># real space projectors are less accurate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span> <span class="c1"># most robust operator</span>

    <span class="k">def</span> <span class="nf">__init_spin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="o">=</span><span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init_ionic_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isif</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ediffg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsw</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potim</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lwave</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_continue_job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;bool: True if continuation job&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">istart</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">icharg</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>

    <span class="nd">@filename</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">fn</span>

<div class="viewcode-block" id="Incar.write"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Incar.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write poscar file</span>

<span class="sd">        Args:</span>
<span class="sd">        filename (str): the filename of the poscar file,</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Incar.read"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Incar.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span> 
                <span class="c1"># ignore comments</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="c1"># ignore blank lines</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                         <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISTART&#39;</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">istart</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ICHARG&#39;</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">icharg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISPIN&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MAGMOM&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISMEAR&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ismear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SIGMA&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ALGO&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;EDIFF&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ediff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ENCUT&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">encut</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NELM&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nelm</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PREC&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;EDIFFG&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ediffg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;IBRION&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISIF&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">isif</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;POTIM&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">potim</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NSW&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nsw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;LWAVE&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lwave</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;LCHARG&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;LVTOT&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;LREAL&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MAGMOM&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ISYM&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">isym</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SYMPREC&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">symprec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;pypospack does not support tag </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">raise</span> <span class="n">VaspIncarError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Incar.set_no_ionic_relaxation"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Incar.set_no_ionic_relaxation">[docs]</a>    <span class="k">def</span> <span class="nf">set_no_ionic_relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isif</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Incar.to_string"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Incar.to_string">[docs]</a>    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__system_information_to_string</span><span class="p">()</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start_information_to_string</span><span class="p">()</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dos_information_to_string</span><span class="p">()</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sym_information_to_string</span><span class="p">()</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scf_information_to_string</span><span class="p">()</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__spin_polarization_to_string</span><span class="p">()</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ionic_relaxation_to_string</span><span class="p">()</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__output_configuration_to_string</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">str_out</span></div>

    <span class="k">def</span> <span class="nf">__system_information_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_out</span> <span class="o">=</span> <span class="s2">&quot;SYSTEM = </span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_out</span>

    <span class="k">def</span> <span class="nf">__start_information_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="n">str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;STARTING INFORMATION&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ISTART&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">istart</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ISTART&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">istart</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ICHARG&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">icharg</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ICHARG&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">icharg</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">str_out</span>

    <span class="k">def</span> <span class="nf">__dos_information_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="n">str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;DENSITY OF STATES&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ISMEAR&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ismear</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ISMEAR&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ismear</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SIGMA&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;SIGMA&#39;</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">str_out</span>

    <span class="k">def</span> <span class="nf">__sym_information_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="n">str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYMMETRY&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ISYM&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">isym</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ISYM&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">isym</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYMPREC&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">symprec</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;SYMPREC&#39;</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">str_out</span>
        

    <span class="k">def</span> <span class="nf">__scf_information_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">=</span> <span class="s1">&#39;Normal&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">=</span> <span class="s1">&#39;VeryFast&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="o">=</span> <span class="s1">&#39;Fast&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VaspIncarError</span><span class="p">(</span><span class="s1">&#39;Unsupported ALGO value:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algo</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">==</span> <span class="s1">&#39;.FALSE.&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">=</span> <span class="s1">&#39;.FALSE.&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">==</span> <span class="s1">&#39;.TRUE.&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lreal</span> <span class="o">=</span> <span class="s1">&#39;.TRUE.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">str_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lreal</span><span class="p">)</span>
            <span class="n">str_value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lreal</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">str_type</span><span class="p">,</span><span class="n">str_value</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VaspIncarError</span><span class="p">(</span><span class="s1">&#39;Unsupported LREAL value:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lreal</span><span class="p">))</span>

        <span class="n">str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ELECTRONIC SCF RELAXATION&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ALGO&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">algo</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ALGO&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">algo</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;PREC&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;PREC&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;LREAL&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lreal</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;LREAL&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">lreal</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;EDIFF&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ediff</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;EDIFF&#39;</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ENCUT&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">encut</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ENCUT&#39;</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;NELM&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nelm</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;NELM&#39;</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">str_out</span>

    <span class="k">def</span> <span class="nf">__spin_polarization_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>

        <span class="n">str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SPIN POLARIZATION CONFIGURATION&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ISPIN&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ispin</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ISPIN&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ispin</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">str_out</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;MAGMOM&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">str_out</span>

    <span class="k">def</span> <span class="nf">__ionic_relaxation_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isif</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># some default configuration for ibrion</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># some default configuration for isif</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isif</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isif</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># some default configuration for EDIFFG</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediffg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ediffg</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.01</span> <span class="c1"># ev/A - typical</span>
        <span class="c1"># some default configuration for POTIM</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potim</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potim</span> <span class="o">=</span> <span class="mf">0.015</span>

        <span class="c1"># some default configuration for NSW</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nsw</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="n">str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;IONIC RELAXATION CONFIGURATION&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;IBRION&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;IBRION&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ISIF&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">isif</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;ISIF&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">isif</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POTIM&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">potim</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;POTIM&#39;</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;NSW&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nsw</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;NSW&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediffg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;EDIFFG&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ediffg</span><span class="p">),</span><span class="s1">&#39;force convergence requirements in ev A&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;EDIFGG&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ediffg</span><span class="p">),</span><span class="s1">&#39;energy convergence in eV&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">str_out</span>

    <span class="k">def</span> <span class="nf">__output_configuration_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lwave</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lwave</span> <span class="o">=</span> <span class="s1">&#39;.TRUE.&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lwave</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lwave</span> <span class="o">=</span> <span class="s1">&#39;.FALSE.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;LWAVE tag cannot be </span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lwave</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">lwave</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VaspIncarException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span> <span class="o">=</span> <span class="s1">&#39;.TRUE.&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span> <span class="o">=</span> <span class="s1">&#39;.FALSE.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;LCHARG tag cannot be </span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VaspIncarException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span> <span class="ow">is</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span> <span class="o">=</span> <span class="s1">&#39;.TRUE.&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span><span class="o">=</span> <span class="s1">&#39;.FALSE.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;LVTOT tag cannot be </span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lwave</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VaspIncarException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="n">str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_section</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;OUTPUT CONFIGURATION&#39;</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;LWAVE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lwave</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;LWAVE&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">lwave</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;LCHARG&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;LCHARG&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">lcharg</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_arg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;LVTOT&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_cmt_dict</span><span class="p">[</span><span class="s1">&#39;LVTOT&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">lvtot</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">str_out</span></div>

<div class="viewcode-block" id="Outcar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Outcar">[docs]</a><span class="k">class</span> <span class="nc">Outcar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; object to manage IO to VASP through the OUTCAR file </span>

<span class="sd">    Many of the attributes in this class are initialized to None at</span>
<span class="sd">    instanciation.  They are processed when the OUTCAR file is read.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): filename of the OUTCAR file</span>

<span class="sd">    Attributes:</span>
<span class="sd">        total_energy (float): total energy of the structure in eV.</span>
<span class="sd">        elastic_tensor (nd.array): the components of the elastic tensor.  The </span>
<span class="sd">            components of the array start at :math:`0`.  So the :math:`c_{11}`</span>
<span class="sd">            component would be accessed by elastic_tensor[0,0]</span>
<span class="sd">        phonon_eig_val (nd.array): the eigenvalues of the phonons determined</span>
<span class="sd">            by lattice dynamics.</span>
<span class="sd">        phonon_eig_vec (nd.array): the eigenvectors of the phonons determined</span>
<span class="sd">            by lattice dynamics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;OUTCAR&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_energy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entropy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elastic_tensor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phonon_eig_val</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># phonon eigenvalues</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phonon_eig_vec</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># phonon eigenvectors</span>
                
<div class="viewcode-block" id="Outcar.read"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Outcar.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read a VASP outcar file and parse for information</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): filename</span>
<span class="sd">            encut (float): energy cutoff for this simulation</span>
<span class="sd">            total_energy (float): total energy for this simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># check if free energy line</span>
                <span class="k">if</span> <span class="s2">&quot;TOTEN&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">E</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">E</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">total_energy</span> <span class="o">=</span> <span class="n">E</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_energy</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">:</span> 
                            <span class="k">pass</span>
                    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_energy</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">:</span> 
                            <span class="k">pass</span> 
                <span class="k">elif</span> <span class="s2">&quot;ENCUT&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">E</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">E</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">encut</span> <span class="o">=</span> <span class="n">E</span>
                <span class="k">elif</span> <span class="s2">&quot;EENTRO&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">E</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">E</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">entropy</span> <span class="o">=</span> <span class="n">E</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entropy</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entropy</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">__string__</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total_energy[eV] = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ecoh_per_structure</span><span class="p">))</span>

<div class="viewcode-block" id="Outcar.get_phonons"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Outcar.get_phonons">[docs]</a>    <span class="k">def</span> <span class="nf">get_phonons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="Outcar.get_time_of_calculation"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Outcar.get_time_of_calculation">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_of_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Outcar.get_number_of_atoms"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Outcar.get_number_of_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="Outcar.get_energy"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Outcar.get_energy">[docs]</a>    <span class="k">def</span> <span class="nf">get_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s2">&quot;OUTCAR&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecoh_per_structure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecoh_per_atom</span> <span class="o">=</span> <span class="kc">None</span></div></div>

<div class="viewcode-block" id="Potcar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Potcar">[docs]</a><span class="k">class</span> <span class="nc">Potcar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; object to deal with POTCAR files for VASP simulations </span>

<span class="sd">    Args:</span>
<span class="sd">        symbols (:obj:`list` of :obj:`str`): a list of chemical symbols</span>
<span class="sd">        filename (str): the filename of the POTCAR</span>
<span class="sd">        xc (str): the exchange correlation model.  Default is &#39;GGA&#39;</span>

<span class="sd">    Attributes:</span>
<span class="sd">        potcar_dir (str): the path of the VASP potential directory.</span>
<span class="sd">        potcars (dict): a dictionary of key-value pairs of symbols to potcar </span>
<span class="sd">            type where the key value is the ISO symbol, and the value is the </span>
<span class="sd">            the psuedopotnetial type.</span>
<span class="sd">            </span>
<span class="sd">    If an :obj:`str` is passed into symbols, then the string will be </span>
<span class="sd">    cast into a :obj:`list` of :obj:`str`</span>
<span class="sd">        </span>
<span class="sd">    A directory of potentials is not included in pypospack because it is</span>
<span class="sd">    protected by copy right.  If the potcar_dir is not set, then pypospack</span>
<span class="sd">    will use the environment variables:</span>

<span class="sd">    &gt;&gt;&gt; export VASP_LDA_DIR=$(cd ~/opt/vasp/potentials/LDA;pwd)</span>
<span class="sd">    &gt;&gt;&gt; export VASP_GGA_DIR=$(cd ~/opt/vasp/potentials/GGA;pwd)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;GGA&#39;</span><span class="p">,</span>
                       <span class="n">potcars</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>                   
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcars</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbols</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;symbols type</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">symbols</span><span class="p">),</span><span class="n">symbols</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">potcars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potcars</span> <span class="o">=</span> <span class="n">potcars</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exch</span>      <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Potcar.read"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Potcar.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">):</span>
        <span class="c1"># initialize arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enmin_max</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span>      <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s1">&#39;TITEL&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">symbol</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;ENMIN&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">obj_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;ENMAX  =  (.*); ENMIN  =  (.*) eV.*&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
                    <span class="n">enmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj_re</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">enmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj_re</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enmin</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enmax</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;LEXCH&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">xc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xc</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;VRHFIN&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span></div>

<div class="viewcode-block" id="Potcar.write"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Potcar.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">src</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">potcars</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; write POTCAR file </span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            pypospack.io.vasp.VaspPotcarError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;cannot find suitable filename&#39;</span><span class="p">)</span>

        <span class="c1">#  if a source potcar is given just copy the file</span>
        <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">__write_potcar_by_copy</span><span class="p">(</span><span class="n">src_fn</span><span class="o">=</span><span class="n">src</span><span class="p">,</span><span class="n">dst_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_xc_directory</span><span class="p">()</span>

        <span class="c1">#  get full path of potcars</span>
        <span class="k">if</span> <span class="n">potcars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potcars</span> <span class="o">=</span> <span class="n">potcars</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__find_potcar_files</span><span class="p">()</span>


        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcars</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
                    <span class="c1"># avoid reading large files into memory</span>
                    <span class="n">chunk_sz</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># 10MB</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">f_in</span><span class="p">,</span><span class="n">f_out</span><span class="p">,</span> <span class="n">chunk_sz</span><span class="p">)</span></div>
             
    <span class="k">def</span> <span class="nf">__write_potcar_by_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">src_fn</span><span class="p">,</span><span class="n">dst_fn</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst_fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">src_fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
                <span class="n">chunk_sz</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">10</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">f_in</span><span class="p">,</span><span class="n">f_out</span><span class="p">,</span><span class="n">chunk_sz</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__find_potcar_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># a more intelligent way of selecting potcars based upon VASP</span>
        <span class="c1"># recommendations should be implemented</span>
        <span class="c1"># http://cms.mpi.univie.ac.at/vasp/vasp/Recommended_PAW_potentials_DFT_calculations_using_vasp_5_2.html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcars</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># initialize</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
            <span class="c1"># try VASP_XC_DIR/symbol/POTCAR</span>
            <span class="k">if</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potcars</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">)</span>
            <span class="c1"># try VASP_XC_DIR/symbol_new/POTCAR</span>
            <span class="k">elif</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_new&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potcars</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_new&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">)</span>
            <span class="c1"># try VASP_XC_DIR/symbols_h/POTCAR</span>
            <span class="k">elif</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_h&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potcars</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_h&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_new&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">))</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;cannot find a POTCAR file for </span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;potcar_dir:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">VaspPotcarError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_xc_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the directory of the exchange correlation functional </span>
<span class="sd">        </span>
<span class="sd">        the exchange correlation functional is set to either &#39;LDA&#39; or &#39;GGA&#39; </span>
<span class="sd">        based upon environment variables</span>

<span class="sd">        Raises:</span>
<span class="sd">            (pypospack.io.vasp.VaspPotcarError): if the directory is not set </span>
<span class="sd">                 as an environment variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">==</span> <span class="s1">&#39;GGA&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VASP_GGA_DIR&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;need to set environment variable VASP_GGA_DIR to the &#39;</span>
                       <span class="s1">&#39;location of the VASP GGA-PBE potential files&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">VaspPotcarError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">==</span> <span class="s1">&#39;LDA&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">potcar_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VASP_LDA_DIR&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;need to set environment variable VASP_LDA_DIR to the &#39;</span>
                       <span class="s1">&#39;location of the VASP LDA-CA potential files&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">header_row</span>   <span class="o">=</span> <span class="s2">&quot;symbol enmin enmax xc</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">format_row</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">) </span><span class="si">{:10.6f}</span><span class="s2"> </span><span class="si">{:10.6f}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
        
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span><span class="p">)</span>
        <span class="n">str_out</span>      <span class="o">=</span> <span class="n">header_row</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
            <span class="n">str_out</span> <span class="o">+=</span> <span class="n">format_row</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_models</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_encut_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_encut_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_xc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">str_out</span></div>
            
<div class="viewcode-block" id="Kpoints"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Kpoints">[docs]</a><span class="k">class</span> <span class="nc">Kpoints</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; KPOINTS file</span>

<span class="sd">    Args:</span>
<span class="sd">        filename(str): the filename to either read from or to write to.  Default is KPOINTS</span>
<span class="sd">        comment(str): a comment to use for the KPOINTS file.  Default is &#39;Automatic Mesh&#39;</span>
<span class="sd">        n_kpoints(int): number of kpoints for automatic mesh.  Default is 0.</span>
<span class="sd">        mesh_type(str): mesh type to create.  Default is &#39;Monkhorst-Pack&#39;</span>
<span class="sd">        mesh_size(:obj:`list` of :obj:`int`): defines the density of the sampling in the </span>
<span class="sd">            Brillouin zone of the reciprocal lattice.</span>
<span class="sd">        mesh_shift(:obj:`list` of :obj:`int`): defines the shift of the k-kpoint mesh</span>

<span class="sd">    Attributes:</span>
<span class="sd">        filename(str): the filename to either read from or to write to.  Default is KPOINTS</span>
<span class="sd">        comment(str): a comment to use for the KPOINTS file.  Default is &#39;Automatic Mesh&#39;</span>
<span class="sd">        n_kpoints(int): number of kpoints for automatic mesh.  Default is 0.</span>
<span class="sd">        mesh_type(str): mesh type to create.  Default is &#39;Monkhorst-Pack&#39;</span>
<span class="sd">        mesh_size(:obj:`list` of :obj:`int`): defines the density of the sampling in the </span>
<span class="sd">            Brillouin zone of the reciprocal lattice.</span>
<span class="sd">        mesh_shift(:obj:`list` of :obj:`int`): defines the shift of the k-kpoint mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;KPOINTS&quot;</span><span class="p">,</span>
                 <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;Automatic Mesh&quot;</span><span class="p">,</span>
                 <span class="n">n_kpoints</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">mesh_type</span> <span class="o">=</span> <span class="s2">&quot;Monkhorst-Pack&quot;</span><span class="p">,</span>
                 <span class="n">mesh_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                 <span class="n">mesh_shift</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_kpoints</span> <span class="o">=</span> <span class="n">n_kpoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_type</span> <span class="o">=</span> <span class="n">mesh_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mesh_size</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_shift</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mesh_shift</span><span class="p">]</span>
   

<div class="viewcode-block" id="Kpoints.to_string"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Kpoints.to_string">[docs]</a>    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_out</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_kpoints</span><span class="p">)</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_type</span><span class="p">)</span>

        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:3d}</span><span class="s2"> </span><span class="si">{:3d}</span><span class="s2"> </span><span class="si">{:3d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_size</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">str_out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:3d}</span><span class="s2"> </span><span class="si">{:3d}</span><span class="s2"> </span><span class="si">{:3d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_shift</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">mesh_shift</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">mesh_shift</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">str_out</span></div>
        
<div class="viewcode-block" id="Kpoints.write"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Kpoints.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Kpoints.read"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Kpoints.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span></div></div>
        
<div class="viewcode-block" id="Poscar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Poscar">[docs]</a><span class="k">class</span> <span class="nc">Poscar</span><span class="p">(</span><span class="n">crystal</span><span class="o">.</span><span class="n">SimulationCell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; POSCAR structure file for VASP</span>

<span class="sd">        Args:</span>
<span class="sd">            obj_cell (pypospack.crystal.SimulationCell):</span>

<span class="sd">        Attributes:</span>
<span class="sd">            filename (str): filename (either to be written to or to write from)</span>
<span class="sd">            comment (str): comment used in the first line of the POSCAR file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj_cell</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">crystal</span><span class="o">.</span><span class="n">SimulationCell</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj_cell</span><span class="p">)</span>             
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;Automatically generated by pypospack&#39;</span> 

<div class="viewcode-block" id="Poscar.read"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Poscar.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read the POSCAR file</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): the file name of the POSCAR file </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        
        <span class="k">try</span><span class="p">:</span>    
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">str_out</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                <span class="s2">&quot;cwd=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()),</span>
                <span class="s2">&quot;filename=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="p">])</span>
            <span class="k">raise</span>
        <span class="c1"># read structure comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># read lattice parameter</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg_err</span> <span class="o">=</span> <span class="s2">&quot;Cannot read the lattice parameter from the POSCAR file</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg_err</span> <span class="o">+=</span> <span class="s2">&quot;filename:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">msg_err</span> <span class="o">+=</span> <span class="s2">&quot;line(</span><span class="si">{}</span><span class="s2">):</span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)),</span>
                <span class="n">line</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">h_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">h_row</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">h_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">h_row</span><span class="p">])</span>
            <span class="n">h_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">h_row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">h_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># read symbols</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="c1"># number of atoms per symbol</span>
        <span class="n">n_atoms_per_symbol</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">n_atoms_per_symbol</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="c1"># read in coordinate type</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">coordinate_style</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">coordinate_style</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_style</span> <span class="o">=</span> <span class="s2">&quot;Direct&quot;</span>
        <span class="k">elif</span> <span class="n">coordinate_style</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_style</span> <span class="o">=</span> <span class="s2">&quot;Cartesian&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;unable to determine the coordinate style </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VaspPoscarError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># read in atomic positions</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
            <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">n_atoms_per_symbol</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i_atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">position</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span></div>
<div class="viewcode-block" id="Poscar.write"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.Poscar.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; write poscar file &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        
        <span class="n">str_poscar</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">str_poscar</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:10.6}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a0</span><span class="p">)</span>
        
        <span class="c1"># string for h-matrix</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">h_row_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:10.6f}</span><span class="s2"> </span><span class="si">{:10.6f}</span><span class="s2"> </span><span class="si">{:10.6f}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">str_poscar</span> <span class="o">+=</span> <span class="n">h_row_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
                                       
        <span class="n">sym_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>
        <span class="n">str_atomlist</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">str_atomnum</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">sym_list</span><span class="p">:</span>
            <span class="n">nAtoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_atoms</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
            <span class="n">str_atomlist</span>   <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">sym</span>
            <span class="n">str_atomnum</span>    <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nAtoms</span><span class="p">)</span>
        <span class="n">str_atomlist</span>   <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">str_atomnum</span>    <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">str_poscar</span> <span class="o">+=</span> <span class="n">str_atomlist</span>
        <span class="n">str_poscar</span> <span class="o">+=</span> <span class="n">str_atomnum</span>
        <span class="n">str_poscar</span> <span class="o">+=</span> <span class="s2">&quot;Direct</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomic_basis</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span><span class="p">:</span>
                    <span class="n">pos_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:10.6f}</span><span class="s2"> </span><span class="si">{:10.6f}</span><span class="s2"> </span><span class="si">{:10.6f}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">str_position</span> <span class="o">=</span> <span class="n">pos_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">atom</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">atom</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">str_poscar</span> <span class="o">+=</span> <span class="n">str_position</span>
 
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">str_poscar</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<span class="c1"># *****************************************************************************</span>
<span class="c1"># ****    SOME HELPER FUNCTIONS</span>
<span class="c1"># *****************************************************************************</span>

<div class="viewcode-block" id="initialize_incar_comments"><a class="viewcode-back" href="../../../pypospack/api/pypospack.io.html#pypospack.io.vasp.initialize_incar_comments">[docs]</a><span class="k">def</span> <span class="nf">initialize_incar_comments</span><span class="p">():</span>
    <span class="n">comments_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISTART&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISTART&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;begin from scratch&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISTART&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;continuation job, constant energy cutoff&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISTART&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;continuation job, constant basis set&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;symmetry off&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;symmetry on&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;symmetry on&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;symmetry on, efficient symmetrization&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;symmetry on, only forces and stress tensor&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;SYMPREC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;determines how accurate positions must be&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Calculate charge density from initial wave functions.&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Read the charge density from file CHGCAR&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Take superposition of atomic charge densities&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tetrahedron method with Blochl corrections&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tetrahedron method&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;method of Gaussian smearing&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;method of Methfessel-Paxton order 1&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;method of Methfessel-Paxton order 2&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;SIGMA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;width of the smearing in eV.&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;NELM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;maximum number of electronic SC&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ENCUT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Cut-off energy for plane wave basis set in eV&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;EDIFF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;convergence condition for SC-loop in eV&#39;</span> 

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;PREC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;PREC&quot;</span><span class="p">][</span><span class="s1">&#39;Accurate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;avoid wrap around errors&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;PREC&quot;</span><span class="p">][</span><span class="s1">&#39;High&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;avoid wrap around errors&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ALGO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ALGO&quot;</span><span class="p">][</span><span class="s2">&quot;Normal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;blocked Davidson iteration scheme&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ALGO&quot;</span><span class="p">][</span><span class="s2">&quot;VeryFast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RMM-DIIS&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ALGO&quot;</span><span class="p">][</span><span class="s2">&quot;Fast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;blocked Davidson, followed by RMM_DIIS&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LREAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LREAL&quot;</span><span class="p">][</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;projection done in reciprocal space&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LREAL&quot;</span><span class="p">][</span><span class="s1">&#39;On&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;method of King-Smith, et al. Phys. Rev B 44, 13063 (1991).&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LREAL&quot;</span><span class="p">][</span><span class="s1">&#39;Auto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unpublished method of G. Kresse&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISPIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISPIN&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;non-spin polarized calculations&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISPIN&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;spin polarized calculations&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;molecular dynamics&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ionic relaxation by RMM-DIIS&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ionic relaxation by CG&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ionic relaxation by damped MD&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;phonons, by frozen ion, without symmetry&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;phonons, by frozen ion, with symmetry&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;phonons, by perturbation theory, no symmetry&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;phonons, by perturbtion theory, with symmetry&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relaxation, ions=T, cellshape=F, cellvolume=F&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relaxation, ions=T, cellshape=T, cellvolume=T&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relaxation, ions=T, cellshape=T, cellvolume=F&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relaxation, ions=F, cellshape=T, cellvolume=F&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relaxation, ions=F, cellshape=T, cellvolume=T&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;relaxation, ions=F, cellshape=F, cellvolume=T&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;POTIM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;scaling factor in relaxation&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;NSW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;maximum number of ionic relaxation steps&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LWAVE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LWAVE&quot;</span><span class="p">][</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;write WAVECAR&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LWAVE&quot;</span><span class="p">][</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;do not write WAVECAR&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LCHARG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LCHARG&quot;</span><span class="p">][</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;write CHGCAR, write CHG&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s2">&quot;LCHARG&quot;</span><span class="p">][</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no CHGCAR, no CHG&#39;</span>

    <span class="n">comments_dict</span><span class="p">[</span><span class="s1">&#39;LVTOT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s1">&#39;LVTOT&#39;</span><span class="p">][</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;write LOCPOT&#39;</span>
    <span class="n">comments_dict</span><span class="p">[</span><span class="s1">&#39;LVTOT&#39;</span><span class="p">][</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no LOCPOT&#39;</span>
    <span class="k">return</span> <span class="n">comments_dict</span></div>

<span class="c1"># standard recommendations</span>
<span class="n">potcar_std</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>
               <span class="s1">&#39;He&#39;</span><span class="p">:</span><span class="s1">&#39;He&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Li&#39;</span><span class="p">:</span><span class="s1">&#39;Li_sv&#39;</span><span class="p">,</span>
               <span class="s1">&#39;Be&#39;</span><span class="p">:</span><span class="s1">&#39;Be&#39;</span><span class="p">,</span>
               <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="s1">&#39;B&#39;</span><span class="p">,</span>
               <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">}</span>
               
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Materials Ex Machina 2017.7.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Eugene J. Ragasa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>