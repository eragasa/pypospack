

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pypospack.task.vasp &#8212; Materials Ex Machina 2017.7.22 documentation</title>
    <link rel="stylesheet" href="../../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/bizstyle.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Materials Ex Machina 2017.7.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pypospack.task.vasp</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;pypospack.task.vasp</span>

<span class="sd">Input and output functions and classes for VASP </span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Eugene J. Ragasa&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2016,2017&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Simplified BSD License&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">shutil</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">yaml</span><span class="o">,</span><span class="nn">copy</span><span class="o">,</span><span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pypospack.crystal</span> <span class="k">as</span> <span class="nn">crystal</span>
<span class="kn">import</span> <span class="nn">pypospack.dft</span> <span class="k">as</span> <span class="nn">dft</span>
<span class="kn">import</span> <span class="nn">pypospack.io.vasp</span> <span class="k">as</span> <span class="nn">vasp</span>
<span class="kn">import</span> <span class="nn">pypospack.io.slurm</span> <span class="k">as</span> <span class="nn">slurm</span>
<span class="kn">from</span> <span class="nn">pypospack.task</span> <span class="k">import</span> <span class="n">Task</span>

<div class="viewcode-block" id="VaspSimulationError"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulationError">[docs]</a><span class="k">class</span> <span class="nc">VaspSimulationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Error class for dealing with VASP simulation issues&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation">[docs]</a><span class="k">class</span> <span class="nc">VaspSimulation</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    The default configuration will do calculate the Energy of the structure</span>
<span class="sd">    using the GGA functional.  The energy cutoff for the plane waves will be</span>
<span class="sd">    set at the highest ENMAX contained in the potcar files.  The Kpoints will</span>
<span class="sd">    be set at 6x6x6 kpoint mesh in the Brillioun zone.</span>

<span class="sd">    Args:</span>
<span class="sd">        task_name(str):</span>
<span class="sd">        task_directory(str): where to create a directory</span>
<span class="sd">        restart(bool): if this flag is set to True, then it will</span>
<span class="sd">            attempt to restart the simulation from information </span>
<span class="sd">            contained in task_directory.  Default is True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        poscar(pypospack.io.vasp.Poscar): A class to manage poscar files</span>
<span class="sd">        incar(pypospack.io.vasp.Incar): A class to manage incar files</span>
<span class="sd">        potcar(pypospack.io.Potcar): A class to manage potcar files</span>
<span class="sd">        kpoints(pypospak.io.Kpoints): A class to manage kpoints</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">Task</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Incar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Potcar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Kpoints</span><span class="p">()</span>
        <span class="c1">#if self.status == &#39;INIT&#39;:</span>
 
            <span class="c1"># additional items to add</span>
            <span class="c1">#additional_config_dict = {\</span>
            <span class="c1">#    &#39;incar&#39;:self.set_incar,</span>
            <span class="c1">#    &#39;poscar&#39;:self.set_poscar,</span>
            <span class="c1">#    &#39;kpoints&#39;:self.set_kpoints,</span>
            <span class="c1">#    &#39;xc&#39;:self.set_xc,</span>
            <span class="c1">#    &#39;encut&#39;:self.set_encut}</span>
            <span class="c1">#additional_ready_dict = {}</span>
            <span class="c1">#additional_run_dict = {}</span>
            <span class="c1">#additional_post_dict = {}</span>
            
            <span class="c1"># update configuration dictionaries</span>
            <span class="c1">#self.config_dict.update(additional_config_dict)</span>
            <span class="c1">#self.ready_dict.update(additional_config_dict)</span>
            <span class="c1">#self.run_dict.update(additional_ready_dict)</span>
            <span class="c1">#self.post_dict.update(additional_post_dict)</span>
            
            <span class="c1">#self.status = &#39;INIT&#39;</span>

<div class="viewcode-block" id="VaspSimulation.restart"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.restart">[docs]</a>    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; overwrite original method &quot;&quot;&quot;</span>
        <span class="n">poscar_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">))</span>
        <span class="n">incar_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">))</span>
        <span class="n">kpoints_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;KPOINTS&#39;</span><span class="p">))</span>
        <span class="n">potcar_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;jobPost&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;DONE&#39;</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;jobCompleted&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;jobSubmitted&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;RUNNING&#39;</span>
        <span class="k">elif</span> <span class="n">poscar_exists</span> <span class="ow">and</span> <span class="n">incar_exists</span> <span class="ow">and</span> <span class="n">kpoints_exists</span> <span class="ow">and</span> <span class="n">potcar_exists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;CONFIG&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
            <span class="c1">#shutil.rmtree(self.task_directory)</span>
            <span class="c1">#os.mkdir(self.task_directory)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;INIT&#39;</span></div>

<div class="viewcode-block" id="VaspSimulation.config"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.config">[docs]</a>    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">poscar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">incar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">kpoints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">xc</span><span class="o">=</span><span class="s1">&#39;GGA&#39;</span><span class="p">):</span>
        <span class="c1"># read the poscar file, then write it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_poscar</span><span class="p">(</span><span class="n">poscar</span><span class="o">=</span><span class="n">poscar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_poscar</span><span class="p">()</span>

        <span class="c1"># write the potcar file, the read in information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_potcar</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="n">xc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_potcar</span><span class="p">()</span>

        <span class="c1"># process incar file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_incar</span><span class="p">(</span><span class="n">incar</span><span class="o">=</span><span class="n">incar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_incar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_incar</span><span class="p">()</span>
        <span class="c1"># process KPOINTS file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_kpoints</span><span class="p">(</span><span class="n">kpoints</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_kpoints</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;CONFIG&#39;</span></div>

<div class="viewcode-block" id="VaspSimulation.run"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">job_type</span><span class="o">=</span><span class="s1">&#39;slurm&#39;</span><span class="p">,</span><span class="n">exec_dict</span><span class="o">=</span><span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_type</span> <span class="o">=</span> <span class="n">job_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_type</span> <span class="o">==</span> <span class="s1">&#39;slurm&#39;</span><span class="p">:</span>
            
            <span class="c1"># create file so we know that job is submitted</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;jobSubmitted&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;job started&#39;</span><span class="p">)</span>

            <span class="c1"># create the slurm submission script</span>
            <span class="n">_slurm_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;runjob_hpc.slurm&#39;</span><span class="p">)</span>
            <span class="n">_slurm_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">exec_dict</span><span class="p">)</span>
            <span class="n">slurm_job</span> <span class="o">=</span> <span class="n">slurm</span><span class="o">.</span><span class="n">SlurmSubmissionScript</span><span class="p">(</span><span class="n">_slurm_dict</span><span class="p">)</span>
            <span class="n">slurm_job</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">_slurm_filename</span><span class="p">)</span>

            <span class="c1"># submit job</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;sbatch runjob_hpc.slurm&#39;</span>
            <span class="n">working_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;do not how to run the simulation using job_type&#39;</span>
                   <span class="s1">&#39;=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_type</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">VaspSimulationError</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;RUNNING&#39;</span></div>

<div class="viewcode-block" id="VaspSimulation.postprocess"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.postprocess">[docs]</a>    <span class="k">def</span> <span class="nf">postprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Some postprocess steps</span>

<span class="sd">        - removes the POTCAR file, for copyright reasons</span>
<span class="sd">        - reads in the OUTCAR file</span>
<span class="sd">        - reads in the OSZICAR file</span>
<span class="sd">        - reads in the CONTCAR file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Outcar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;OUTCAR&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contcar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contcar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;CONTCAR&#39;</span><span class="p">))</span>
        <span class="c1"># self.oszicar = vasp.Oszicar()</span>
        <span class="c1"># self.oszicar.read(os.path.join(self.task_directory,&#39;OSZICAR&#39;))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_simulation_for_failure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span></div>

<div class="viewcode-block" id="VaspSimulation.check_simulation_for_failure"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.check_simulation_for_failure">[docs]</a>    <span class="k">def</span> <span class="nf">check_simulation_for_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="VaspSimulation.get_results"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="VaspSimulation.read_poscar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.read_poscar">[docs]</a>    <span class="k">def</span> <span class="nf">read_poscar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">poscar</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read in a poscar file or object</span>

<span class="sd">        This method reads in new structural information into the class.  It does </span>
<span class="sd">        not write the POSCAR file which may already exist in the the simulation</span>
<span class="sd">        directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            poscar (:obj:`str` or :obj:`pypospack.crystal.SimulationCell`): </span>
<span class="sd">                structure information file either provided as the location of a </span>
<span class="sd">                POSCAR file, or from an instance of </span>
<span class="sd">                :obj:`pypospack.crystal.SimulationCell`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">poscar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">poscar</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poscar</span><span class="p">,</span><span class="n">crystal</span><span class="o">.</span><span class="n">SimulationCell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">(</span><span class="n">poscar</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poscar</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">poscar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>\
                   <span class="s2">&quot;argument &#39;poscar&#39; must be a filename or an instance &quot;</span>
                   <span class="s2">&quot;of pypospack.crystal.SimulationCell, passed in </span><span class="si">{}</span><span class="s2">&quot;</span>
                   <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">poscar</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">KeyError</span></div>

<div class="viewcode-block" id="VaspSimulation.write_poscar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.write_poscar">[docs]</a>    <span class="k">def</span> <span class="nf">write_poscar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_poscar_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_poscar_filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspSimulation.read_potcar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.read_potcar">[docs]</a>    <span class="k">def</span> <span class="nf">read_potcar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>\
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s2">&quot;POTCAR&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="VaspSimulation.write_potcar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.write_potcar">[docs]</a>    <span class="k">def</span> <span class="nf">write_potcar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xc</span><span class="o">=</span><span class="s1">&#39;GGA&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>\
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s2">&quot;POTCAR&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="VaspSimulation.read_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.read_incar">[docs]</a>    <span class="k">def</span> <span class="nf">read_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">incar</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">incar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Incar</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Incar</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Incar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">incar</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># check to see if the incar already exists, and read it in</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Incar</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">))</span>
            <span class="c1"># otherwise, we&#39;re just going to use the default configuarion</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Incar</span><span class="p">()</span>
            <span class="c1"># now update based upon what is dictionary</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">incar</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VaspSimulationError</span></div>

<div class="viewcode-block" id="VaspSimulation.config_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.config_incar">[docs]</a>    <span class="k">def</span> <span class="nf">config_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># if spin-polarized calculations, then set magmom tag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">_magmom_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">*</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="n">_magmom_str</span></div>
        <span class="c1">#potcar_encut_min = max(self.potcar.encut_min)</span>
        <span class="c1">#potcar_encut_max = 2*max(self.potcar.encut_max)</span>
        <span class="c1">#if self.incar.encut == &#39;Auto&#39;:</span>
        <span class="c1">#    self.incar.encut = max(self.potcar.encut_max)</span>
        <span class="c1">#if self.incar.encut &gt;= potcar_encut_min:</span>
        <span class="c1">#    self.incar.encut = potcar_encut_min</span>
        <span class="c1">#if self.incar.encut &lt;= potcar_encut_max:</span>
        <span class="c1">#    self.incar.encut = potcar_encut_max</span>

<div class="viewcode-block" id="VaspSimulation.write_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.write_incar">[docs]</a>    <span class="k">def</span> <span class="nf">write_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="VaspSimulation.read_kpoints"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.read_kpoints">[docs]</a>    <span class="k">def</span> <span class="nf">read_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kpoints</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kpoints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;KPOINTS&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Kpoints</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;KPOINTS&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Kpoints</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpoints</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Kpoints</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">kpoints</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpoints</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;KPOINTS&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Kpoints</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;KPOINTS&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Kpoints</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kpoints</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VaspSimulationError</span></div>

<div class="viewcode-block" id="VaspSimulation.config_kpoints"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.config_kpoints">[docs]</a>    <span class="k">def</span> <span class="nf">config_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># check for tetrahedron method and switch to</span>
        <span class="c1"># gamma</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ismear</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">mesh_type</span> <span class="o">=</span> <span class="s1">&#39;Gamma&#39;</span></div>

        <span class="c1"># check to see if we have a hexagonal cell</span>
        
<div class="viewcode-block" id="VaspSimulation.write_kpoints"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.write_kpoints">[docs]</a>    <span class="k">def</span> <span class="nf">write_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>\
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;KPOINTS&#39;</span><span class="p">))</span></div>
<div class="viewcode-block" id="VaspSimulation.slurm_is_done"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.slurm_is_done">[docs]</a>    <span class="k">def</span> <span class="nf">slurm_is_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_dir</span><span class="p">,</span><span class="s1">&#39;jobComplete&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span></div>

    <span class="k">def</span> <span class="nf">set_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">incar_info</span><span class="p">):</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar_info</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">incar_info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cond1</span> <span class="ow">and</span> <span class="n">cond2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">incar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

<div class="viewcode-block" id="VaspSimulation.set_poscar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.set_poscar">[docs]</a>    <span class="k">def</span> <span class="nf">set_poscar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">poscar_info</span><span class="p">):</span>
        <span class="n">cond1</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar_info</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">cond2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">incar_info</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cond1</span> <span class="ow">and</span> <span class="n">cond2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">poscar</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poscar</span><span class="p">,</span><span class="n">pypospack</span><span class="o">.</span><span class="n">crystal</span><span class="o">.</span><span class="n">SimulationCell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">(</span><span class="n">poscar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="VaspSimulation.set_kpoints"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.set_kpoints">[docs]</a>    <span class="k">def</span> <span class="nf">set_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kpoints_info</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

    <span class="k">def</span> <span class="nf">set_xc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>

    <span class="k">def</span> <span class="nf">set_encut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encut</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut</span> <span class="o">=</span> <span class="n">encut</span>
<div class="viewcode-block" id="VaspSimulation.req_config"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.req_config">[docs]</a>    <span class="k">def</span> <span class="nf">req_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="VaspSimulation.snd_config"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.snd_config">[docs]</a>    <span class="k">def</span> <span class="nf">snd_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sends configuration information and configures</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="VaspSimulation.set_xc"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.set_xc">[docs]</a>    <span class="k">def</span> <span class="nf">set_xc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span></div>

<div class="viewcode-block" id="VaspSimulation.set_encut"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.set_encut">[docs]</a>    <span class="k">def</span> <span class="nf">set_encut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encut</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut</span> <span class="o">=</span> <span class="n">encut</span></div>

<div class="viewcode-block" id="VaspSimulation.set_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.set_incar">[docs]</a>    <span class="k">def</span> <span class="nf">set_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">incar</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">incar</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">incar</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">incar</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;do not know how to process incar params&#39;</span>
            <span class="k">raise</span> <span class="n">VaspSimulationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>
<div class="viewcode-block" id="VaspSimulation.get_encut_from_potcar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspSimulation.get_encut_from_potcar">[docs]</a>    <span class="k">def</span> <span class="nf">get_encut_from_potcar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">encut_max</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="VaspStructuralMinimization"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspStructuralMinimization">[docs]</a><span class="k">class</span> <span class="nc">VaspStructuralMinimization</span><span class="p">(</span><span class="n">VaspSimulation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Task class for VASP structural minimization</span>

<span class="sd">    The default configuration will do a full structural minimization using</span>
<span class="sd">    the GGA functional.  The energy cutoff for the plane waves will be set</span>
<span class="sd">    at the highest ENMAX contained in the POTCAR files.  The Kpoints will be</span>
<span class="sd">    set at the 6x6x6 kpoint mesh in the Brillioun zone.  Forces are </span>
<span class="sd">    minimized to 1e-3 ev/Angs.</span>

<span class="sd">    Args:</span>
<span class="sd">        task_name(str): the task name for this VASP simulation</span>
<span class="sd">        task_directory(str): where to create a directory</span>
<span class="sd">        restart(bool): if this flag is set to True, then it will attempt</span>
<span class="sd">           restart the simulation from information contained in task_directory.</span>
<span class="sd">           Default is True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        poscar(pypospack.io.vasp.Poscar): A class to manage poscar files</span>
<span class="sd">        incar(pypospack.io.vasp.Incar): A class to manage incar files</span>
<span class="sd">        potcar(pypospack.io.Potcar): A class to manage potcar files</span>
<span class="sd">        kpoints(pypospak.io.Kpoints): A class to manage kpoints</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">VaspSimulation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="p">)</span>

<div class="viewcode-block" id="VaspStructuralMinimization.config_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspStructuralMinimization.config_incar">[docs]</a>    <span class="k">def</span> <span class="nf">config_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">VaspSimulation</span><span class="o">.</span><span class="n">config_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ibrion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># set to conjugate gradient method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">isif</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># relax everything</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">nsw</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="VaspPositionMinimization"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspPositionMinimization">[docs]</a><span class="k">class</span> <span class="nc">VaspPositionMinimization</span><span class="p">(</span><span class="n">VaspSimulation</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">VaspSimulation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="p">)</span>

<div class="viewcode-block" id="VaspPositionMinimization.config_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspPositionMinimization.config_incar">[docs]</a>    <span class="k">def</span> <span class="nf">config_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">VaspSimulation</span><span class="o">.</span><span class="n">config_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ibrion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># set to conjugate gradient method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">isif</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># relax positions only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">nsw</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="VaspCalculatePhonons"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspCalculatePhonons">[docs]</a><span class="k">class</span> <span class="nc">VaspCalculatePhonons</span><span class="p">(</span><span class="n">VaspSimulation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculate the phonons &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">VaspSimulation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">task_name</span><span class="p">,</span><span class="n">task_directory</span><span class="p">,</span><span class="n">restart</span><span class="o">=</span><span class="n">restart</span><span class="p">)</span>

<div class="viewcode-block" id="VaspCalculatePhonons.config_incar"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspCalculatePhonons.config_incar">[docs]</a>    <span class="k">def</span> <span class="nf">config_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">VaspSimulation</span><span class="o">.</span><span class="n">config_incar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ibrion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">=</span> <span class="mi">6</span> <span class="c1"># frozen phonon mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">potim</span> <span class="o">=</span> <span class="mf">0.015</span> <span class="c1"># displacements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">isif</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_directory</span><span class="p">,</span><span class="s1">&#39;INCAR&#39;</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="VaspWorkflow"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow">[docs]</a><span class="k">class</span> <span class="nc">VaspWorkflow</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is an abstract implementation of VaspWorkflow.  Currently, it</span>
<span class="sd">    can only handle a batch of tasks to send to a SLURM job submission system.</span>
<span class="sd">    In order to use this abstract class, you need to subclass this class</span>

<span class="sd">        Args:</span>
<span class="sd">            directory(str): directory where the the simulations are going to</span>
<span class="sd">                be put.  Default is None, which will set this to the current</span>
<span class="sd">                working directory.  Relative paths are converted to absolute</span>
<span class="sd">                paths.</span>
<span class="sd">            xc(str): the exchange correlation functional.  The choices are</span>
<span class="sd">                LDA and GGA.  LDA is the local density approximation. GGA</span>
<span class="sd">                is General Gradient Approximation.</span>
<span class="sd">            incar_dict(dict): a dictionary of the tags and values for the </span>
<span class="sd">                INCAR input file.  The tags are contained in the keys in</span>
<span class="sd">                lower case.  The setting the each respective take is contained</span>
<span class="sd">                in the value section of the key-value pair.</span>
<span class="sd">            slurm_dict(dict): a dictionary of the tags and values for managing</span>
<span class="sd">                submissions to a cluster server running SLURM.</span>
<span class="sd">            full_auto(bool): Default is True</span>
<span class="sd">            filename_results(str):Default is &#39;default&#39;.</span>
<span class="sd">            manifest_filename(str):Default is &#39;pypospack.manifest.yaml&#39;</span>
<span class="sd">        Attributes:</span>
<span class="sd">            directory(str):</span>
<span class="sd">            xc(str)</span>
<span class="sd">            incar_dict(str)</span>
<span class="sd">            slurm_dict(str)</span>
<span class="sd">            full_auto</span>
<span class="sd">            filename_results</span>
<span class="sd">            manifest_filename</span>

<span class="sd">        References:</span>
<span class="sd">            LDA - CA</span>
<span class="sd">            GGA - General Gradient Approximation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span><span class="n">xc</span><span class="o">=</span><span class="s1">&#39;GGA&#39;</span><span class="p">,</span><span class="n">incar_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">slurm_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">full_auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">filename_results</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">manifest_filename</span> <span class="o">=</span> <span class="s1">&#39;pypospack.manifest.yaml&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orig_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span> <span class="o">=</span> <span class="n">filename_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span> <span class="o">=</span> <span class="n">manifest_filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process_directory_arg</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="c1"># change the location of the result output file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span><span class="p">)</span>

        <span class="c1"># change the location of the manifest file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span>
        <span class="c1"># check argument &#39;structure&#39;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span><span class="n">crystal</span><span class="o">.</span><span class="n">SimulationCell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># convert to absolute path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">orig_directory</span><span class="p">,</span>
                    <span class="n">structure</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">)</span>

            <span class="c1"># read the poscar file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_err</span> <span class="o">=</span> <span class="s2">&quot;structure must either be an instance of &quot;</span>
            <span class="n">msg_err</span> <span class="o">+=</span> <span class="s2">&quot;pypospack.crystal.SimulationCell or a string&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>

        <span class="c1"># self exchange correlation functional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>

        <span class="c1"># set incar_dict</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">incar_dict</span><span class="p">)</span>

        <span class="c1"># set slurm_dict</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slurm_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slurm_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">slurm_dict</span><span class="p">)</span>
      
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">full_auto</span> <span class="o">=</span> <span class="n">full_auto</span>


<div class="viewcode-block" id="VaspWorkflow.do_full_auto"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow.do_full_auto">[docs]</a>    <span class="k">def</span> <span class="nf">do_full_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">()</span></div>

<div class="viewcode-block" id="VaspWorkflow.create_manifest"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow.create_manifest">[docs]</a>    <span class="k">def</span> <span class="nf">create_manifest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="n">SlurmSimulationManifest</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="p">,</span>
                    <span class="n">SlurmSimulationManifest</span><span class="p">)</span>
        
        <span class="c1"># check conditions to initialize simulation manifest</span>
        <span class="n">is_manifest_configured</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">is_self_configured</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="ow">not</span> <span class="n">is_manifest_configured</span><span class="p">,</span>\
                <span class="n">is_self_configured</span><span class="p">]):</span>

            <span class="c1"># the manifest task list should be the same as </span>
            <span class="c1"># the task list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
                <span class="n">task_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">task_directory</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_directory</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;complete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span>

        <span class="c1"># --- raises errors </span>
        <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="ow">not</span> <span class="n">is_manifest_configured</span><span class="p">,</span>\
                <span class="ow">not</span> <span class="n">is_self_configured</span><span class="p">]):</span>
            <span class="n">msg_err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;manifest attribute is configured, but neither the task nor &quot;</span>
                <span class="s2">&quot;the task_list attribute have been configured&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>
        <span class="c1"># --- catch all other conditions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;In trying to configure the manifest file, an unsupported &quot;</span>
                <span class="s2">&quot;state was reached</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;is_manifest_configured:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;    manifest=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;    manifest.task_list=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;is_self_configured:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;    task_list=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;    tasks=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">is_manifest_configured</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="p">)),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span><span class="p">)),</span>
                            <span class="n">is_self_configured</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">)),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">))</span>
                            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span></div>
                
<div class="viewcode-block" id="VaspWorkflow.start"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_simulations</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_manifest</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="c1"># manage the SlurmSimulationManifest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="n">SlurmSimulationManifest</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
            <span class="n">task_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">task_directory</span>
            <span class="c1">#TODO:</span>
            <span class="c1"># task_is_created = self.task[task_name].is_created</span>
            <span class="c1"># task_is_submitted = self.task[task_name].is_submitted</span>
            <span class="c1"># task_is_compled = self.task[task_name].is_completed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_directory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;complete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># TODO: i should do some process checking here </span>
        <span class="c1"># This should be added into the pypospack.task.vasp.VaspSimulation</span>
        <span class="c1"># import subprocess</span>
        <span class="c1"># from subprocess import check_output, CalledProcessError</span>
        <span class="c1"># try:</span>
        <span class="c1">#     out = subprocess.check_output([&quot;dir&quot;]) # windows  out = check_output([&quot;cmd&quot;, &quot;/c&quot;, &quot;dir&quot;])</span>
        <span class="c1"># except CalledProcessError as e:</span>
        <span class="c1">#    out = e.output</span>
        <span class="c1">#    print(out)v</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">run_simulations</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;sim_submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspWorkflow.restart"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow.restart">[docs]</a>    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># read_simulation_manifest()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="n">SlurmSimulationManifest</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
            <span class="n">task_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">VaspSimulation</span><span class="p">(</span>\
                <span class="n">task_name</span><span class="o">=</span><span class="n">task_name</span><span class="p">,</span>
                <span class="n">task_directory</span><span class="o">=</span><span class="n">task_directory</span><span class="p">,</span>
                <span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;CONFIG&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;RUN&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;complete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">all_sims_complete</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;complete&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

        <span class="k">if</span> <span class="n">all_sims_complete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post_process</span><span class="p">()</span>

            <span class="c1"># write out everything</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;encut&#39;</span><span class="p">,</span><span class="s1">&#39;total_energy&#39;</span><span class="p">,</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">,</span><span class="s1">&#39;total_energy_per_atom&#39;</span><span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">task_results</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">])</span>
            <span class="n">str_out</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">str_out</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;simulations not complete&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="VaspWorkflow.create_simulations"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow.create_simulations">[docs]</a>    <span class="k">def</span> <span class="nf">create_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method populates the attributes: task_list and tasks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="VaspWorkflow.run_simulations"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow.run_simulations">[docs]</a>    <span class="k">def</span> <span class="nf">run_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">task_name</span><span class="p">,</span><span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">job_type</span><span class="o">=</span><span class="s1">&#39;slurm&#39;</span><span class="p">,</span><span class="n">exec_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slurm_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspWorkflow.post_process"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspWorkflow.post_process">[docs]</a>    <span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task_name</span><span class="p">,</span><span class="n">task_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">task_obj</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="n">task_obj</span><span class="o">.</span><span class="n">postprocess</span><span class="p">()</span>

                <span class="n">encut</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">encut</span>
                <span class="n">total_energy</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">total_energy</span>
                <span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">contcar</span><span class="o">.</span><span class="n">atomic_basis</span><span class="p">)</span>
                <span class="n">total_energy_per_atom</span> <span class="o">=</span> <span class="n">total_energy</span><span class="o">/</span><span class="n">n_atoms</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">task_results</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;encut&#39;</span><span class="p">:</span><span class="n">encut</span><span class="p">,</span>
                        <span class="s1">&#39;total_energy&#39;</span><span class="p">:</span><span class="n">total_energy</span><span class="p">,</span>
                        <span class="s1">&#39;n_atoms&#39;</span><span class="p">:</span><span class="n">n_atoms</span><span class="p">,</span>
                        <span class="s1">&#39;total_energy_per_atom&#39;</span><span class="p">:</span><span class="n">total_energy_per_atom</span><span class="p">}</span></div>

    <span class="k">def</span> <span class="nf">_process_directory_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if directory is None, then set to the current working directory.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">orig_directory</span><span class="p">,</span>
                    <span class="n">directory</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># since the directory exists, then a simulation may have been</span>
            <span class="c1"># already started in this location.</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="VaspKpointsConvergence"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspKpointsConvergence">[docs]</a><span class="k">class</span> <span class="nc">VaspKpointsConvergence</span><span class="p">(</span><span class="n">VaspWorkflow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">       structure(str or pypospack.crystal.SimulationCell):</span>
<span class="sd">        xc</span>
<span class="sd">        incar_dict</span>
<span class="sd">        slurm_dict</span>
<span class="sd">        full_auto</span>
<span class="sd">        rho_min</span>
<span class="sd">        rho_max</span>
<span class="sd">        d_rho</span>
<span class="sd">        kpoint_min</span>
<span class="sd">        kpoint_max</span>
<span class="sd">    Attributes:</span>
<span class="sd">        rho_min</span>
<span class="sd">        rho_max</span>
<span class="sd">        d_rho</span>
<span class="sd">        kpoint_min</span>
<span class="sd">        kpoint_max</span>
<span class="sd">        orig_directory</span>
<span class="sd">        filename_results</span>
<span class="sd">        manifest_filename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">structure</span><span class="o">=</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span><span class="n">xc</span><span class="o">=</span><span class="s1">&#39;GGA&#39;</span><span class="p">,</span><span class="n">incar_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">slurm_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">full_auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">rho_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rho_max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">d_rho</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">kpoint_min</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">kpoint_max</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
       
        <span class="n">VaspWorkflow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span><span class="n">xc</span><span class="o">=</span><span class="n">xc</span><span class="p">,</span><span class="n">incar_dict</span><span class="o">=</span><span class="n">incar_dict</span><span class="p">,</span>
            <span class="n">slurm_dict</span><span class="o">=</span><span class="n">slurm_dict</span><span class="p">,</span><span class="n">full_auto</span><span class="o">=</span><span class="n">full_auto</span><span class="p">,</span>
            <span class="n">filename_results</span> <span class="o">=</span> <span class="s1">&#39;converg.kpoints.results&#39;</span><span class="p">,</span>
            <span class="n">manifest_filename</span> <span class="o">=</span> <span class="s1">&#39;pypospack.manifest.yaml&#39;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_dict</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span>

        <span class="c1"># copy parameters --&gt; attributes of the class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho_min</span> <span class="o">=</span> <span class="n">rho_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho_max</span> <span class="o">=</span> <span class="n">rho_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_rho</span> <span class="o">=</span> <span class="n">d_rho</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoint_min</span> <span class="o">=</span> <span class="n">kpoint_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoint_max</span> <span class="o">=</span> <span class="n">kpoint_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span> <span class="o">=</span> <span class="s1">&#39;converg.kpoints.results&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span> <span class="o">=</span> <span class="s1">&#39;pypospack.manifest.yaml&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_auto</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_full_auto</span><span class="p">()</span>
    
        <span class="c1"># --- PROCESS ARGUMENTS ---</span>
        <span class="c1"># process the dictionary attribute</span>
<div class="viewcode-block" id="VaspKpointsConvergence.do_full_auto"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspKpointsConvergence.do_full_auto">[docs]</a>    <span class="k">def</span> <span class="nf">do_full_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_simulations</span><span class="p">()</span></div>

<div class="viewcode-block" id="VaspKpointsConvergence.create_simulations"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspKpointsConvergence.create_simulations">[docs]</a>    <span class="k">def</span> <span class="nf">create_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># step 1: determine list of simulations</span>
        <span class="c1"># kpoint_meshes(dict)</span>
        <span class="c1"># --&gt; key(str): &quot;kp_{k1}_{k2}_{k3}&quot;.format(int,int,int)</span>
        <span class="c1"># --&gt; value(list): [int,int,int]</span>
        <span class="n">kpoint_meshes</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">determine_kpoint_meshes</span><span class="p">(</span>
                <span class="n">simulation_cell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="p">,</span>
                <span class="n">rho_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_min</span><span class="p">,</span>
                <span class="n">rho_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_max</span><span class="p">,</span>
                <span class="n">d_rho</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d_rho</span><span class="p">,</span>
                <span class="n">kpoint_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kpoint_min</span><span class="p">,</span>
                <span class="n">kpoint_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kpoint_max</span><span class="p">)</span>
        
        <span class="c1"># create_task_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">kpoint_meshes</span><span class="p">]</span> <span class="c1"># &lt;--- convert keys of dict to list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="c1"># step 2: loop over list of simulations</span>
        <span class="k">for</span> <span class="n">kp_key</span><span class="p">,</span><span class="n">kp_mesh</span> <span class="ow">in</span> <span class="n">kpoint_meshes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># SLURM INFO</span>
            <span class="n">task_name</span> <span class="o">=</span> <span class="n">kp_key</span>
            <span class="n">task_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span><span class="n">task_name</span><span class="p">)</span>
            <span class="c1"># &lt;--- THIS AREA IS DIFFERENT FOR THIS SIMULATION ---&gt;</span>
            <span class="c1"># check that kp_mesh = [k1,k2,k3]</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kp_mesh</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kp_mesh</span><span class="p">])</span>
            <span class="n">kpoints_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mesh_size&#39;</span><span class="p">:</span><span class="n">kp_mesh</span><span class="p">}</span>
            <span class="c1"># &lt;--- END DIFFERENCES ---&gt;</span>

            <span class="c1"># Step 2(b).  Create Simulations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">VaspSimulation</span><span class="p">(</span>
                    <span class="n">task_name</span><span class="o">=</span><span class="n">task_name</span><span class="p">,</span>
                    <span class="n">task_directory</span><span class="o">=</span><span class="n">task_directory</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
                        <span class="n">poscar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">,</span>
                        <span class="n">incar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_dict</span><span class="p">,</span>
                        <span class="n">kpoints</span><span class="o">=</span><span class="n">kpoints_dict</span><span class="p">,</span>
                        <span class="n">xc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;debugging code&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">task_name:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task_name</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">task_obj:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]))))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">task_obj.potcar:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">potcar</span><span class="p">))))</span>
                <span class="k">raise</span></div></div>

<div class="viewcode-block" id="VaspEncutConvergence"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspEncutConvergence">[docs]</a><span class="k">class</span> <span class="nc">VaspEncutConvergence</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        structure(str or pypospack.crystal.Structure):</span>
<span class="sd">        xc(str): exchange correlation functional</span>
<span class="sd">        encut_min(int): minimum of the range for the energy cutoff, in eV</span>
<span class="sd">        encut_max(int): maximum of the range for the energy cutoff, in eV</span>
<span class="sd">        encut_step(int): interval between simulations of energy cutoffs, in eV</span>
<span class="sd">        incar_dict(str): parameters for the VASP simulation</span>
<span class="sd">        slurm_dict(str): job submission parameters for the VASP simulation</span>
<span class="sd">    Attributes:</span>
<span class="sd">        poscar(pypospack.io.vasp.Poscar)</span>
<span class="sd">        encut_min(int)</span>
<span class="sd">        encut_max(int)</span>
<span class="sd">        encut_step(int)</span>
<span class="sd">        task(dict)</span>
<span class="sd">        task_results(dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">structure</span><span class="o">=</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span><span class="n">xc</span><span class="o">=</span><span class="s1">&#39;GGA&#39;</span><span class="p">,</span>
            <span class="n">encut_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">encut_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">encut_step</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
            <span class="n">incar_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">kpoints_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">slurm_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">full_auto</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span> <span class="o">=</span> <span class="s1">&#39;converg.encut.results&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span> <span class="o">=</span> <span class="s1">&#39;pypospack.manifest.yaml&#39;</span>

        <span class="c1"># --- PROCESS ARGUMENTS ---</span>
        <span class="c1"># process the dictionary attribute</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">orig_directory</span><span class="p">,</span>
                    <span class="n">directory</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>

        <span class="c1"># change the location of the result output file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span>
        <span class="c1"># check argument &#39;structure&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span><span class="n">crystal</span><span class="o">.</span><span class="n">SimulationCell</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="s1">&#39;POSCAR&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">structure_filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">structure</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># convert to absolute path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">orig_directory</span><span class="p">,</span>
                    <span class="n">structure</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">)</span>

            <span class="c1"># read the poscar file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Poscar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg_err</span> <span class="o">=</span> <span class="s2">&quot;structure must either be an instance of &quot;</span>
            <span class="n">msg_err</span> <span class="o">+=</span> <span class="s2">&quot;pypospack.crystal.SimulationCell or a string&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg_err</span><span class="p">)</span>

        <span class="c1"># self exchange correlation functional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>

        <span class="c1"># determine energy cutoff</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">encut_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">encut_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]):</span>
            <span class="c1"># create a potcar containing the information contained in the </span>
            <span class="c1"># potcar files</span>
            <span class="n">potcar</span> <span class="o">=</span> <span class="n">vasp</span><span class="o">.</span><span class="n">Potcar</span><span class="p">()</span>
            <span class="n">potcar</span><span class="o">.</span><span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poscar</span><span class="o">.</span><span class="n">symbols</span>
            <span class="n">potcar</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>

            <span class="c1"># this is kind of clunky because I have to write the potcar file</span>
            <span class="c1"># before i read it.</span>
            <span class="c1"># TODO: what I should actually do is read the POTCARS for each</span>
            <span class="c1">#       individual symbol and collect the information I need</span>
            <span class="n">potcar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;POTCAR.tmp&#39;</span><span class="p">)</span>
            <span class="n">potcar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;POTCAR.tmp&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;POTCAR.tmp&#39;</span><span class="p">)</span>

            <span class="c1"># set encut min</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">encut_min</span><span class="p">,</span><span class="nb">float</span><span class="p">),</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">encut_min</span><span class="p">,</span><span class="nb">int</span><span class="p">)]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span> <span class="o">=</span> <span class="n">encut_min</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">potcar</span><span class="o">.</span><span class="n">encut_min</span><span class="p">)</span>

            <span class="c1"># set encut max</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">encut_max</span><span class="p">,</span><span class="nb">float</span><span class="p">),</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">encut_max</span><span class="p">,</span><span class="nb">int</span><span class="p">)]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span> <span class="o">=</span> <span class="n">encut_max</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="nb">max</span> <span class="p">(</span><span class="n">potcar</span><span class="o">.</span><span class="n">encut_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span> <span class="o">=</span> <span class="n">encut_min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span> <span class="o">=</span> <span class="n">encut_max</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span><span class="o">//</span><span class="n">encut_step</span><span class="p">)</span><span class="o">*</span><span class="n">encut_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span><span class="o">//</span><span class="n">encut_step</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">encut_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encut_step</span> <span class="o">=</span> <span class="n">encut_step</span>

        <span class="c1"># set incut_dict</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incar_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">incar_dict</span><span class="p">)</span>

        <span class="c1"># set kpoints_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kpoints_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kpoints_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">kpoints_dict</span><span class="p">)</span> 
        
        <span class="c1"># set slurm_dict</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slurm_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slurm_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">slurm_dict</span><span class="p">)</span>

        <span class="c1"># additional attributes which aren&#39;t parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">full_auto</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_full_auto</span><span class="p">()</span>

<div class="viewcode-block" id="VaspEncutConvergence.do_full_auto"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspEncutConvergence.do_full_auto">[docs]</a>    <span class="k">def</span> <span class="nf">do_full_auto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_simulations</span><span class="p">()</span>
            <span class="c1"># write_simulation_manifest()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="n">SlurmSimulationManifest</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
                <span class="n">task_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">task_directory</span>
                <span class="c1">#TODO:</span>
                <span class="c1"># task_is_created = self.task[task_name].is_created</span>
                <span class="c1"># task_is_submitted = self.task[task_name].is_submitted</span>
                <span class="c1"># task_is_compled = self.task[task_name].is_completed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_directory</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;complete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">run_simulations</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># read_simulation_manifest()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span> <span class="o">=</span> <span class="n">SlurmSimulationManifest</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest_filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">task_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
                <span class="n">task_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;directory&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">VaspSimulation</span><span class="p">(</span>\
                    <span class="n">task_name</span><span class="o">=</span><span class="n">task_name</span><span class="p">,</span>
                    <span class="n">task_directory</span><span class="o">=</span><span class="n">task_directory</span><span class="p">,</span>
                    <span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;CONFIG&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;RUN&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;submitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="s1">&#39;complete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">all_sims_complete</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;complete&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

            <span class="k">if</span> <span class="n">all_sims_complete</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">post_process</span><span class="p">()</span>

                <span class="c1"># write out everything</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;encut&#39;</span><span class="p">,</span><span class="s1">&#39;total_energy&#39;</span><span class="p">,</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">,</span><span class="s1">&#39;total_energy_per_atom&#39;</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span><span class="p">:</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">task_results</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">])</span>
                <span class="n">str_out</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="n">str_out</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_results</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;simulations not complete&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspEncutConvergence.create_simulations"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspEncutConvergence.create_simulations">[docs]</a>    <span class="k">def</span> <span class="nf">create_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># local copy</span>
        <span class="n">encut_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encut_min</span>
        <span class="n">encut_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encut_max</span>
        <span class="n">encut_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encut_step</span>

        <span class="n">encuts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">encut_min</span><span class="p">,</span><span class="n">encut_max</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">encut_step</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">encut</span> <span class="ow">in</span> <span class="n">encuts</span><span class="p">:</span>
            <span class="n">encut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">encut</span><span class="p">)</span>
            <span class="n">str_encut</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">encut</span><span class="p">)</span>
            <span class="n">incar_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">incar_dict</span><span class="p">)</span>
            <span class="n">incar_dict</span><span class="p">[</span><span class="s1">&#39;encut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encut</span>
            
            <span class="n">task_name</span> <span class="o">=</span> <span class="n">str_encut</span>
            <span class="n">task_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span><span class="n">task_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">VaspSimulation</span><span class="p">(</span>
                        <span class="n">task_name</span><span class="o">=</span><span class="n">task_name</span><span class="p">,</span>
                        <span class="n">task_directory</span><span class="o">=</span><span class="n">task_directory</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpoints_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
                           <span class="n">poscar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">,</span>
                           <span class="n">incar</span><span class="o">=</span><span class="n">incar_dict</span><span class="p">,</span>
                           <span class="n">xc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_kpoints_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kpoints_dict</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
                           <span class="n">poscar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_filename</span><span class="p">,</span>
                           <span class="n">incar</span><span class="o">=</span><span class="n">incar_dict</span><span class="p">,</span>
                           <span class="n">xc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;debugging code&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">task_name:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">task_name</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">task_obj:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]))))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">task_obj.potcar:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">potcar</span><span class="p">))))</span>
                <span class="k">raise</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">encuts</span><span class="p">]</span></div>

<div class="viewcode-block" id="VaspEncutConvergence.run_simulations"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspEncutConvergence.run_simulations">[docs]</a>    <span class="k">def</span> <span class="nf">run_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">task_name</span><span class="p">,</span><span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">job_type</span><span class="o">=</span><span class="s1">&#39;slurm&#39;</span><span class="p">,</span><span class="n">exec_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slurm_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspEncutConvergence.post_process"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.VaspEncutConvergence.post_process">[docs]</a>    <span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task_name</span><span class="p">,</span><span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
                <span class="n">task</span><span class="o">.</span><span class="n">postprocess</span><span class="p">()</span>

                <span class="n">encut</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">encut</span>
                <span class="n">total_energy</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">total_energy</span>
                <span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">contcar</span><span class="o">.</span><span class="n">atomic_basis</span><span class="p">)</span>
                <span class="n">total_energy_per_atom</span> <span class="o">=</span> <span class="n">total_energy</span><span class="o">/</span><span class="n">n_atoms</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">task_results</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;encut&#39;</span><span class="p">:</span><span class="n">encut</span><span class="p">,</span>
                    <span class="s1">&#39;total_energy&#39;</span><span class="p">:</span><span class="n">total_energy</span><span class="p">,</span>
                    <span class="s1">&#39;n_atoms&#39;</span><span class="p">:</span><span class="n">n_atoms</span><span class="p">,</span>
                    <span class="s1">&#39;total_energy_per_atom&#39;</span><span class="p">:</span><span class="n">total_energy_per_atom</span><span class="p">}</span></div></div>
         
<span class="c1"># ---- temporary classes until i can write a VaspSimulationManager ---</span>

<div class="viewcode-block" id="SimulationManifest"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.SimulationManifest">[docs]</a><span class="k">class</span> <span class="nc">SimulationManifest</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;pypospack.manifest.yaml&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<div class="viewcode-block" id="SimulationManifest.process"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.SimulationManifest.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="SimulationManifest.read"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.SimulationManifest.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="SimulationManifest.write"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.SimulationManifest.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>

<div class="viewcode-block" id="SlurmSimulationManifest"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.SlurmSimulationManifest">[docs]</a><span class="k">class</span> <span class="nc">SlurmSimulationManifest</span><span class="p">(</span><span class="n">SimulationManifest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;pypospack.manifest.yaml&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manifest_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="SlurmSimulationManifest.read"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.SlurmSimulationManifest.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">manifest</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;task_list&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="SlurmSimulationManifest.write"><a class="viewcode-back" href="../../../pypospack/api/pypospack.task.html#pypospack.task.vasp.SlurmSimulationManifest.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">manifest</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;task_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_list</span>
        <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Materials Ex Machina 2017.7.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Eugene J. Ragasa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>